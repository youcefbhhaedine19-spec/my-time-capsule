<!DOCTYPE html>
<html lang="ar" dir="rtl" id="htmlTag">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Capsule | ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø²Ù…Ù†</title>
    <style>
        :root { 
            --primary: #38bdf8; 
            --bg: #020617; 
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --shadow: rgba(0, 0, 0, 0.5);
        }
        
        /* Ø«ÙŠÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .theme-purple { --primary: #a855f7; --bg: #1e1b4b; }
        .theme-green { --primary: #22c55e; --bg: #052e16; }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: background-color 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ù†Ø¬ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            opacity: 0.4;
        }

        .stars {
            width: 200%;
            height: 200%;
            background: radial-gradient(1px 1px at 20px 30px, #fff, rgba(0,0,0,0)),
                        radial-gradient(1px 1px at 50px 70px, #fff, rgba(0,0,0,0)),
                        radial-gradient(2px 2px at 100px 150px, #fff, rgba(0,0,0,0));
            background-repeat: repeat;
            background-size: 250px 250px;
            animation: moveStars 120s linear infinite;
        }

        @keyframes moveStars {
            from { transform: translate(0, 0); }
            to { transform: translate(-50%, -50%); }
        }

        /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Glassmorphism) */
        .container {
            background: var(--glass);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            padding: 40px;
            border-radius: 35px;
            border: 1px solid var(--border);
            width: 90%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 25px 60px var(--shadow);
            position: relative;
            z-index: 10;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .header-tools {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .lang-btn, .theme-swatch {
            background: rgba(255,255,255,0.08);
            border: 1px solid var(--border);
            color: white;
            padding: 8px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: 0.3s;
        }

        .theme-swatch { width: 24px; height: 24px; border-radius: 50%; padding: 0; }

        h1 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--primary);
            text-shadow: 0 0 20px rgba(56, 189, 248, 0.4);
            letter-spacing: 1px;
        }

        /* Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
        .input-group { margin-bottom: 20px; text-align: right; }
        [dir="ltr"] .input-group { text-align: left; }

        label { display: block; margin-bottom: 8px; font-size: 0.9rem; opacity: 0.8; }

        input, textarea {
            width: 100%;
            padding: 15px;
            border-radius: 15px;
            border: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.4);
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.2);
            background: rgba(0, 0, 0, 0.6);
        }

        .hidden-content { -webkit-text-security: disc; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn-main {
            background: var(--primary);
            color: #020617;
            border: none;
            padding: 16px 30px;
            border-radius: 50px;
            font-weight: 800;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-top: 10px;
        }

        .btn-main:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--primary);
            filter: brightness(1.1);
        }

        /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ */
        #timer-box { display: none; margin: 30px 0; }
        .countdown-display {
            font-size: 3.5rem;
            font-weight: 900;
            color: var(--primary);
            font-family: monospace;
            text-shadow: 0 0 30px rgba(56, 189, 248, 0.3);
        }

        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØµÙØ±Ø§Ø¡ */
        .notice-card {
            background: rgba(245, 158, 11, 0.1);
            border-right: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.85rem;
            color: #fbbf24;
            display: none;
        }
        [dir="ltr"] .notice-card { border-right: none; border-left: 4px solid #f59e0b; }

        /* Ø§Ù„ÙÙˆØªØ± ÙˆØ§Ù„Ù„ÙˆØ¬Ùˆ */
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .logo-svg {
            width: 45px;
            height: 45px;
            stroke: var(--primary);
            filter: drop-shadow(0 0 10px var(--primary));
            animation: float 4s ease-in-out infinite;
        }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .dev-tag { font-size: 0.8rem; opacity: 0.6; letter-spacing: 2px; }
        .dev-tag span { color: var(--primary); font-weight: bold; }

        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ */
        #final-msg {
            display: none;
            padding: 25px;
            border: 2px dashed var(--primary);
            border-radius: 20px;
            background: rgba(56, 189, 248, 0.05);
            margin-top: 20px;
            font-size: 1.2rem;
            line-height: 1.6;
        }
    </style>
</head>
<body id="body">

    <div class="stars-container"><div class="stars"></div></div>

    <div class="container">
        <div class="header-tools">
            <select class="lang-btn" id="langSwitch" onchange="updateLanguage(this.value)">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="en">English</option>
            </select>
            <div style="display:flex; gap: 10px;">
                <div class="theme-swatch" style="background:#38bdf8" onclick="applyTheme('default')"></div>
                <div class="theme-swatch" style="background:#a855f7" onclick="applyTheme('purple')"></div>
                <div class="theme-swatch" style="background:#22c55e" onclick="applyTheme('green')"></div>
            </div>
        </div>

        <h1 id="ui-title">ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø²Ù…Ù† ğŸš€</h1>

        <div id="view-setup">
            <div class="notice-card" id="ui-notice">
                âš ï¸ Ù‡Ø§Ù…: Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ø°Ù‡ Ù…Ø±ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø¨Ø±ÙŠØ¯Ùƒ Ø¹Ø¨Ø± Ø±Ø³Ø§Ù„Ø© Verify Ø§Ù„ØªÙŠ Ø³ØªØµÙ„Ùƒ Ø§Ù„Ø¢Ù† Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø©.
            </div>
            <div class="input-group">
                <label id="ui-label-mail">Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                <input type="email" id="userMail" placeholder="name@domain.com">
            </div>
            <button class="btn-main" onclick="handleMailStep()" id="ui-btn-next">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø±Ø­Ù„Ø© ğŸ‘¨â€ğŸš€</button>
        </div>

        <div id="view-lock" style="display:none;">
            <div class="input-group">
                <label id="ui-label-note">Ø±Ø³Ø§Ù„ØªÙƒ Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„:</label>
                <textarea id="userNote" class="hidden-content" rows="4" placeholder="..." onfocus="this.classList.remove('hidden-content')" onblur="this.classList.add('hidden-content')"></textarea>
            </div>
            <div class="input-group">
                <label id="ui-label-date">Ù…ÙˆØ¹Ø¯ ÙØªØ­ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø©:</label>
                <input type="datetime-local" id="unlockDate">
            </div>
            <button class="btn-main" onclick="handleLockStep()" id="ui-btn-lock">Ù‚ÙÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø¯Ø§Ø± ğŸ”’</button>
        </div>

        <div id="timer-box">
            <p id="ui-status">Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© ÙÙŠ Ø·Ø±ÙŠÙ‚Ù‡Ø§ Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„...</p>
            <div class="countdown-display" id="clock">00:00:00</div>
            <div id="final-msg"></div>
            <button class="btn-main" id="reset-btn" style="display:none; background:#ef4444; color:white;" onclick="clearAllData()">Ø¨Ø¯Ø¡ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ğŸ”„</button>
        </div>

        <div class="footer">
            <svg class="logo-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.85 1.85 0 0 0 .2-1y6 6 0 1 0-11.6 4 6.06 6.06 0 0 0-1.6.2"></path>
                <circle cx="12" cy="12" r="10" stroke-opacity="0.2"></circle>
            </svg>
            <p class="dev-tag">DESIGNED BY <span>YOUSSEF</span></p>
        </div>
    </div>

    <script>
        // Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø®Ø§Øµ
        const WEB3_KEY = "33abda0d-9a62-43ba-bdd4-a1d4a62c8567";

        // Ù†ØµÙˆØµ Ø§Ù„Ù„ØºØ§Øª
        const dictionary = {
            ar: {
                title: "ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø²Ù…Ù† ğŸš€",
                labelMail: "Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:",
                btnNext: "Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø±Ø­Ù„Ø© ğŸ‘¨â€ğŸš€",
                labelNote: "Ø±Ø³Ø§Ù„ØªÙƒ Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„:",
                labelDate: "Ù…ÙˆØ¹Ø¯ ÙØªØ­ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø©:",
                btnLock: "Ù‚ÙÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø¯Ø§Ø± ğŸ”’",
                status: "Ø³ÙŠØªÙ… ÙØªØ­ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© Ø®Ù„Ø§Ù„:",
                notice: "âš ï¸ Ù‡Ø§Ù…: Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·ØŒ Ø³ØªØ­ØªØ§Ø¬ Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ø±ÙŠØ¯Ùƒ Ø¹Ø¨Ø± Ø±Ø³Ø§Ù„Ø© Verify Ø³ØªØµÙ„Ùƒ Ø§Ù„Ø¢Ù†.",
                alertMail: "ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø¥ÙŠÙ…ÙŠÙ„ ØµØ­ÙŠØ­",
                alertData: "ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ù„ÙˆÙ‚Øª",
                mailSubject: "ğŸš€ ØªÙ… Ù‚ÙÙ„ ÙƒØ¨Ø³ÙˆÙ„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!",
                mailBody: "Ø±Ø³Ø§Ù„ØªÙƒ Ù…Ø¤Ù…Ù†Ø© Ø§Ù„Ø¢Ù†. Ø¥Ø°Ø§ Ù„Ù… ØªØµÙ„Ùƒ Ø±Ø³Ø§Ø¦Ù„Ù†Ø§ØŒ ØªÙÙ‚Ø¯ Ø§Ù„Ù€ Spam ÙˆØ§Ø¶ØºØ· Verify."
            },
            en: {
                title: "Time Capsule ğŸš€",
                labelMail: "Your Email Address:",
                btnNext: "Continue Mission ğŸ‘¨â€ğŸš€",
                labelNote: "Message to the Future:",
                labelDate: "Unlock Date & Time:",
                btnLock: "Lock & Launch ğŸ”’",
                status: "Capsule unlocks in:",
                notice: "âš ï¸ Note: For the first time, you must verify your email via the link sent to you.",
                alertMail: "Please enter a valid email",
                alertData: "Please fill message and date",
                mailSubject: "ğŸš€ Capsule Locked Successfully!",
                mailBody: "Your message is safe. If you don't see our emails, check Spam and click Verify."
            }
        };

        let currentLang = localStorage.getItem('lang') || 'ar';

        // 1. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„ØºØ§Øª
        function updateLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            const d = dictionary[lang];
            
            document.getElementById('htmlTag').dir = (lang === 'ar' ? 'rtl' : 'ltr');
            document.getElementById('ui-title').innerText = d.title;
            document.getElementById('ui-label-mail').innerText = d.labelMail;
            document.getElementById('ui-btn-next').innerText = d.btnNext;
            document.getElementById('ui-label-note').innerText = d.labelNote;
            document.getElementById('ui-label-date').innerText = d.labelDate;
            document.getElementById('ui-btn-lock').innerText = d.btnLock;
            document.getElementById('ui-status').innerText = d.status;
            document.getElementById('ui-notice').innerText = d.notice;
        }

        // 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«ÙŠÙ…Ø§Øª
        function applyTheme(theme) {
            document.getElementById('body').className = (theme === 'default' ? '' : 'theme-' + theme);
            localStorage.setItem('theme', theme);
        }

        // 3. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„)
        function handleMailStep() {
            const mail = document.getElementById('userMail').value;
            if (mail.includes('@')) {
                localStorage.setItem('email', mail);
                document.getElementById('ui-notice').style.display = 'block';
                refreshUI();
            } else {
                alert(dictionary[currentLang].alertMail);
            }
        }

        // 4. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø§Ù„Ù‚ÙÙ„)
        async function handleLockStep() {
            const note = document.getElementById('userNote').value;
            const date = document.getElementById('unlockDate').value;

            if (!note || !date) {
                alert(dictionary[currentLang].alertData);
                return;
            }

            const timestamp = new Date(date).getTime();
            localStorage.setItem('note', note);
            localStorage.setItem('time', timestamp);

            // Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù‚ÙÙ„
            await triggerEmail(dictionary[currentLang].mailSubject, dictionary[currentLang].mailBody);
            refreshUI();
        }

        // 5. Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ù„ÙØªØ­ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function initCountdown() {
            const target = parseInt(localStorage.getItem('time'));
            
            const timer = setInterval(async () => {
                const now = new Date().getTime();
                const diff = target - now;

                if (diff <= 0) {
                    clearInterval(timer);
                    if (!sessionStorage.getItem('opened')) {
                        sessionStorage.setItem('opened', 'true');
                        executeUnlock();
                    } else {
                        displayMessageOnly();
                    }
                } else {
                    const h = Math.floor(diff / 3600000);
                    const m = Math.floor((diff % 3600000) / 60000);
                    const s = Math.floor((diff % 60000) / 1000);
                    document.getElementById('clock').innerText = 
                        `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
                }
            }, 1000);
        }

        async function executeUnlock() {
            displayMessageOnly();
            const note = localStorage.getItem('note');
            await triggerEmail("ğŸ”“ ÙÙØªØ­Øª Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø¢Ù†!", "Ø¥Ù„ÙŠÙƒ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„ØªÙŠ Ø§Ù†ØªØ¸Ø±ØªÙ‡Ø§: \n\n" + note);
        }

        function displayMessageOnly() {
            document.getElementById('clock').style.display = 'none';
            document.getElementById('ui-status').style.display = 'none';
            const box = document.getElementById('final-msg');
            box.style.display = 'block';
            box.innerText = `"${localStorage.getItem('note')}"`;
            document.getElementById('reset-btn').style.display = 'block';
        }

        // 6. Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        async function triggerEmail(subject, message) {
            try {
                await fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        access_key: WEB3_KEY,
                        email: localStorage.getItem('email'),
                        subject: subject,
                        message: message,
                        from_name: "Time Capsule"
                    })
                });
            } catch (err) { console.error("Email error:", err); }
        }

        // 7. ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function refreshUI() {
            const email = localStorage.getItem('email');
            const time = localStorage.getItem('time');

            if (email && !time) {
                document.getElementById('view-setup').style.display = 'none';
                document.getElementById('view-lock').style.display = 'block';
            } else if (email && time) {
                document.getElementById('view-setup').style.display = 'none';
                document.getElementById('view-lock').style.display = 'none';
                document.getElementById('timer-box').style.display = 'block';
                initCountdown();
            }
        }

        function clearAllData() {
            localStorage.clear();
            sessionStorage.clear();
            location.reload();
        }

        // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
        updateLanguage(currentLang);
        applyTheme(localStorage.getItem('theme') || 'default');
        refreshUI();
    </script>
</body>
</html>

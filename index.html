<!DOCTYPE html>
<html lang="ar" dir="rtl" id="htmlTag">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Capsule Elite | ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø²Ù…Ù† Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        /* --- Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø§Ù… --- */
        :root { 
            --primary: #38bdf8; 
            --primary-glow: rgba(56, 189, 248, 0.5);
            --bg: #020617; 
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --error: #ef4444;
            --success: #22c55e;
        }

        .theme-purple { --primary: #a855f7; --primary-glow: rgba(168, 85, 247, 0.5); --bg: #0f172a; }
        .theme-green { --primary: #10b981; --primary-glow: rgba(16, 185, 129, 0.5); --bg: #064e3b; }

        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }

        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- Ù†Ø¸Ø§Ù… Ø®Ù„ÙÙŠØ© Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… --- */
        #space-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at center, #111827 0%, #020617 100%);
        }

        .star-layer {
            position: absolute;
            width: 200%;
            height: 200%;
            background-image: 
                radial-gradient(1px 1px at 20px 30px, #fff, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 50px 70px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 150px 200px, #fff, rgba(0,0,0,0));
            background-repeat: repeat;
            animation: moveStars 180s linear infinite;
            opacity: 0.4;
        }

        @keyframes moveStars {
            from { transform: translate(0, 0); }
            to { transform: translate(-20%, -20%); }
        }

        /* --- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --- */
        .main-wrapper {
            background: var(--glass);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            padding: 50px;
            border-radius: 40px;
            border: 1px solid var(--border);
            width: 95%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.6);
            position: relative;
            transform: translateY(0);
            transition: 0.5s;
        }

        /* --- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… --- */
        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
        }

        .btn-mini {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: #ccc;
            padding: 8px 14px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            transition: 0.3s;
        }

        .btn-mini:hover { background: rgba(255, 255, 255, 0.1); color: white; }

        .theme-dots { display: flex; gap: 10px; }
        .dot { width: 14px; height: 14px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: 0.3s; }
        .dot:hover { transform: scale(1.3); }
        .dot.active { border-color: white; }

        /* --- Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†ØµÙŠØ© --- */
        h1 {
            font-size: 2.4rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #fff, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .subtitle { font-size: 0.95rem; opacity: 0.6; margin-bottom: 30px; line-height: 1.5; }

        /* --- Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØ§Ù„Ù…Ø¯Ø®Ù„Ø§Øª --- */
        .form-section { display: none; animation: fadeIn 0.6s ease-out forwards; }
        .form-section.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .input-wrap { text-align: right; margin-bottom: 20px; }
        [dir="ltr"] .input-wrap { text-align: left; }

        label { display: block; font-size: 0.85rem; margin-bottom: 8px; color: var(--primary); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

        input, textarea {
            width: 100%;
            padding: 18px;
            border-radius: 18px;
            border: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.4);
            color: white;
            font-size: 1rem;
            transition: 0.4s;
            outline: none;
        }

        input:focus, textarea:focus {
            border-color: var(--primary);
            background: rgba(0, 0, 0, 0.6);
            box-shadow: 0 0 20px var(--primary-glow);
        }

        /* --- Ø§Ù„Ø£Ø²Ø±Ø§Ø± --- */
        .cta-button {
            background: var(--primary);
            color: #000;
            border: none;
            padding: 20px;
            border-radius: 50px;
            width: 100%;
            font-weight: 800;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .cta-button:hover { transform: translateY(-4px); box-shadow: 0 15px 30px var(--primary-glow); }
        .cta-button:active { transform: translateY(0); }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ --- */
        .timer-display { margin: 40px 0; }
        #clock { font-size: 4rem; font-weight: 900; font-family: 'Courier New', monospace; color: var(--primary); letter-spacing: -2px; }
        
        .progress-container { width: 100%; height: 6px; background: rgba(255,255,255,0.05); border-radius: 10px; margin-top: 20px; overflow: hidden; }
        .progress-bar { width: 0%; height: 100%; background: var(--primary); transition: 0.3s; }

        /* --- Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© --- */
        #final-content {
            display: none;
            padding: 25px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px dashed var(--primary);
            margin-top: 20px;
            font-size: 1.2rem;
            line-height: 1.8;
            color: #ddd;
        }

        /* --- Ø§Ù„ÙÙˆØªØ± ÙˆØ§Ù„Ù„ÙˆØ¬Ùˆ --- */
        .footer-logo { margin-top: 45px; border-top: 1px solid var(--border); padding-top: 25px; }
        .ship-icon { width: 45px; fill: var(--primary); filter: drop-shadow(0 0 10px var(--primary)); animation: float 4s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-12px) rotate(5deg); } }
        .brand { font-size: 12px; opacity: 0.4; letter-spacing: 3px; margin-top: 10px; }
        .brand span { color: var(--primary); font-weight: bold; opacity: 1; }

        /* --- Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ÙˆØ³Ø§Ø¦Ø· --- */
        @media (max-width: 480px) {
            .main-wrapper { padding: 30px; }
            h1 { font-size: 1.8rem; }
            #clock { font-size: 3rem; }
        }
    </style>
</head>
<body id="masterBody">

    <div id="space-canvas"><div class="star-layer"></div></div>

    <div class="main-wrapper" id="mainCard">
        <div class="nav-bar">
            <select class="btn-mini" id="langSwitch" onchange="toggleLang(this.value)">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="en">English</option>
            </select>
            <div class="theme-dots">
                <div class="dot active" style="background: #38bdf8;" onclick="updateTheme('default', this)"></div>
                <div class="dot" style="background: #a855f7;" onclick="updateTheme('purple', this)"></div>
                <div class="dot" style="background: #10b981;" onclick="updateTheme('green', this)"></div>
            </div>
        </div>

        <h1 id="ui-title">ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø²Ù…Ù† ğŸš€</h1>
        <p class="subtitle" id="ui-subtitle">Ø³Ø¬Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø¢Ù†ØŒ ÙˆØ³Ù†Ù‚ÙˆÙ… Ø¨ØªÙˆØµÙŠÙ„Ù‡Ø§ Ù„Ùƒ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø¹Ø¨Ø± Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.</p>

        <div id="sec-1" class="form-section active">
            <div class="input-wrap">
                <label id="ui-l-mail">Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
                <input type="email" id="emailInput" placeholder="name@domain.com">
            </div>
            <button class="cta-button" onclick="nextSection(2)">
                <span id="ui-btn-1">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </button>
        </div>

        <div id="sec-2" class="form-section">
            <div class="input-wrap">
                <label id="ui-l-note">Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ©</label>
                <textarea id="noteInput" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø´ÙŠØ¦Ø§Ù‹ ØªÙˆØ¯ Ù‚Ø±Ø§Ø¡ØªÙ‡ Ø¨Ø¹Ø¯ Ø³Ù†ÙˆØ§Øª..."></textarea>
            </div>
            <div class="input-wrap">
                <label id="ui-l-date">Ù…ÙˆØ¹Ø¯ ÙØªØ­ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø©</label>
                <input type="datetime-local" id="dateInput">
            </div>
            <button class="cta-button" onclick="lockAndLaunch()">
                <span id="ui-btn-2">Ø¥Ø·Ù„Ø§Ù‚ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø§Ø±</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 2v20M2 12h20M12 2l4 4-4-4zm0 20l-4-4 4 4z"/></svg>
            </button>
        </div>

        <div id="sec-3" class="form-section">
            <p id="ui-status">Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ù…Ø¯Ø§Ø±.. Ø³ÙŠØªÙ… Ø§Ù„Ù‡Ø¨ÙˆØ· Ø®Ù„Ø§Ù„:</p>
            <div class="timer-display">
                <div id="clock">00:00:00</div>
                <div class="progress-container"><div class="progress-bar" id="pBar"></div></div>
            </div>
            <div id="final-content"></div>
            <button class="cta-button" id="newMissionBtn" style="display:none; background: var(--error); color: white;" onclick="clearSystem()">
                <span id="ui-btn-reset">Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
            </button>
        </div>

        <div class="footer-logo">
            <svg class="ship-icon" viewBox="0 0 24 24"><path d="M12 2.25a.75.75 0 01.75.75v1.285c3.73.413 6.697 3.38 7.11 7.11H21a.75.75 0 010 1.5h-1.14c-.413 3.73-3.38 6.697-7.11 7.11V21a.75.75 0 01-1.5 0v-1.255c-3.73-.413-6.697-3.38-7.11-7.11H3a.75.75 0 010-1.5h1.14c.413-3.73 3.38-6.697 7.11-7.11V3a.75.75 0 01.75-.75zM12 15a3 3 0 100-6 3 3 0 000 6z"/></svg>
            <p class="brand">PRO MISSION BY <span>YOUSSEF</span></p>
        </div>
    </div>

    <script>
        /* --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª --- */
        const CFG = {
            sid: "service_ih7jn54",
            tid: "template_oz29fcd",
            pk: "NinIk0LzvyV4NVzoD"
        };

        emailjs.init(CFG.pk);

        const TXT = {
            ar: {
                t: "ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø²Ù…Ù† ğŸš€", st: "Ø³Ø¬Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø¢Ù†ØŒ ÙˆØ³Ù†Ù‚ÙˆÙ… Ø¨ØªÙˆØµÙŠÙ„Ù‡Ø§ Ù„Ùƒ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø¹Ø¨Ø± Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.",
                l1: "Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙ„Ù…", l2: "Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ©", l3: "Ù…ÙˆØ¹Ø¯ ÙØªØ­ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø©", b1: "Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©", b2: "Ø¥Ø·Ù„Ø§Ù‚ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø§Ø±",
                err: "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!", s: "Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ù…Ø¯Ø§Ø±.. Ø³ÙŠØªÙ… Ø§Ù„Ù‡Ø¨ÙˆØ· Ø®Ù„Ø§Ù„:", rs: "Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©",
                sub: "ğŸ”“ ÙÙØªØ­Øª ÙƒØ¨Ø³ÙˆÙ„ØªÙƒ Ø§Ù„Ø²Ù…Ù†ÙŠØ©!", hi: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ", body: "Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§ Ù„Ù†ÙØ³Ùƒ Ù…Ù† Ø§Ù„Ù…Ø§Ø¶ÙŠ:", foot: "Ù…Ø¹ ØªØ­ÙŠØ§ØªØŒ ÙØ±ÙŠÙ‚ ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø²Ù…Ù†."
            },
            en: {
                t: "Time Capsule ğŸš€", st: "Record your message now, and we will deliver it to you in the future via cyberspace.",
                l1: "Recipient Email", l2: "Secret Message", l3: "Unlock Date & Time", b1: "Start Mission", b2: "Launch to Orbit",
                err: "Invalid Data!", s: "Capsule in orbit.. Landing in:", rs: "New Mission",
                sub: "ğŸ”“ Your Time Capsule has opened!", hi: "Hello,", body: "This is the message you sent to your future self:", foot: "Best regards, Time Capsule Team."
            }
        };

        let currentLang = localStorage.getItem('app_lang') || 'ar';
        let timerInterval;

        /* --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --- */
        function toggleLang(l) {
            currentLang = l;
            localStorage.setItem('app_lang', l);
            const d = TXT[l];
            document.getElementById('htmlTag').dir = l === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('ui-title').innerText = d.t;
            document.getElementById('ui-subtitle').innerText = d.st;
            document.getElementById('ui-l-mail').innerText = d.l1;
            document.getElementById('ui-l-note').innerText = d.l2;
            document.getElementById('ui-l-date').innerText = d.l3;
            document.getElementById('ui-btn-1').innerText = d.b1;
            document.getElementById('ui-btn-2').innerText = d.b2;
            document.getElementById('ui-status').innerText = d.s;
            document.getElementById('ui-btn-reset').innerText = d.rs;
        }

        function updateTheme(t, el) {
            document.getElementById('masterBody').className = t === 'default' ? '' : 'theme-' + t;
            document.querySelectorAll('.dot').forEach(d => d.classList.remove('active'));
            el.classList.add('active');
            localStorage.setItem('app_theme', t);
        }

        function nextSection(num) {
            const mail = document.getElementById('emailInput').value;
            if (num === 2 && !mail.includes('@')) return alert(TXT[currentLang].err);
            
            localStorage.setItem('tmp_mail', mail);
            document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
            document.getElementById('sec-' + num).classList.add('active');
        }

        function lockAndLaunch() {
            const note = document.getElementById('noteInput').value;
            const date = document.getElementById('dateInput').value;
            
            if (!note || !date) return alert(TXT[currentLang].err);

            const targetTime = new Date(date).getTime();
            const now = new Date().getTime();

            if (targetTime <= now) return alert(TXT[currentLang].err);

            localStorage.setItem('app_note', note);
            localStorage.setItem('app_time', targetTime);
            localStorage.setItem('app_start', now);

            refreshSystem();
        }

        function refreshSystem() {
            const mail = localStorage.getItem('tmp_mail');
            const time = localStorage.getItem('app_time');

            if (mail && !time) {
                nextSection(2);
            } else if (mail && time) {
                document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
                document.getElementById('sec-3').classList.add('active');
                runCountdown();
            }
        }

        function runCountdown() {
            const target = parseInt(localStorage.getItem('app_time'));
            const start = parseInt(localStorage.getItem('app_start'));

            timerInterval = setInterval(() => {
                const now = new Date().getTime();
                const diff = target - now;
                const total = target - start;

                if (diff <= 0) {
                    clearInterval(timerInterval);
                    if (!sessionStorage.getItem('notified')) finalizeMission();
                } else {
                    const h = Math.floor(diff / 3600000);
                    const m = Math.floor((diff % 3600000) / 60000);
                    const s = Math.floor((diff % 60000) / 1000);
                    document.getElementById('clock').innerText = 
                        `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
                    
                    const progress = ((now - start) / total) * 100;
                    document.getElementById('pBar').style.width = progress + "%";
                }
            }, 1000);
        }

        async function finalizeMission() {
            sessionStorage.setItem('notified', 'true');
            const d = TXT[currentLang];
            const note = localStorage.getItem('app_note');

            document.getElementById('clock').innerText = "DONE âœ…";
            document.getElementById('pBar').style.width = "100%";
            document.getElementById('final-content').style.display = 'block';
            document.getElementById('final-content').innerText = `"${note}"`;
            document.getElementById('newMissionBtn').style.display = 'flex';

            const params = {
                user_email: localStorage.getItem('tmp_mail'),
                subject_line: d.sub,
                email_greeting: d.hi,
                email_body: d.body,
                message: note,
                email_footer: d.foot
            };

            try {
                await emailjs.send(CFG.sid, CFG.tid, params);
                console.log("Transmission complete.");
            } catch (e) {
                console.error("System Error:", e);
            }
        }

        function clearSystem() {
            if (confirm("Reset System? / Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·ØŸ")) {
                localStorage.clear();
                sessionStorage.clear();
                location.reload();
            }
        }

        /* --- Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ --- */
        toggleLang(currentLang);
        const savedTheme = localStorage.getItem('app_theme') || 'default';
        document.getElementById('masterBody').className = savedTheme === 'default' ? '' : 'theme-' + savedTheme;
        refreshSystem();

    </script>
</body>
</html>

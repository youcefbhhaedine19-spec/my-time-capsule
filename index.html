<!DOCTYPE html>
<html lang="ar" dir="rtl" id="htmlTag">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Capsule | ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø²Ù…Ù†</title>
    <style>
        :root { --primary: #38bdf8; --bg-dark: #020617; --accent: rgba(56, 189, 248, 0.2); }
        .theme-purple { --primary: #a855f7; --bg-dark: #1e1b4b; --accent: rgba(168, 85, 247, 0.2); }
        .theme-green { --primary: #22c55e; --bg-dark: #052e16; --accent: rgba(34, 197, 94, 0.2); }

        body {
            background-color: var(--bg-dark); color: white;
            font-family: 'Segoe UI', sans-serif; margin: 0;
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; height: 100vh; overflow: hidden;
            transition: background 0.5s ease;
        }

        .stars {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(white, transparent 2%);
            background-size: 50px 50px; animation: moveStars 120s linear infinite;
            z-index: -1; opacity: 0.2;
        }
        @keyframes moveStars { from { background-position: 0 0; } to { background-position: 1000px 1000px; } }

        .toolbar {
            position: absolute; top: 20px; width: 90%;
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }

        #langSelect {
            background: rgba(0, 0, 0, 0.6); color: white;
            border: 2px solid var(--primary); padding: 8px 12px;
            border-radius: 10px; cursor: pointer; outline: none; backdrop-filter: blur(5px);
        }

        .theme-btn {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px; border-radius: 50%; cursor: pointer; margin-left: 5px; font-size: 1.2rem;
        }

        .capsule-container {
            background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1); padding: 2.5rem;
            border-radius: 30px; text-align: center; width: 85%; max-width: 400px;
            box-shadow: 0 0 40px var(--accent);
        }

        .logo-container { margin-bottom: 15px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        input, textarea {
            width: 100%; background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px;
            color: white; padding: 12px; margin-bottom: 15px; box-sizing: border-box; outline: none;
        }

        .hidden-note { -webkit-text-security: disc; } /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© */

        input[type="datetime-local"] { background: white; color: black; }

        .main-btn {
            background: var(--primary); color: var(--bg-dark);
            border: none; padding: 15px; border-radius: 50px;
            font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s;
        }
        .main-btn:hover { opacity: 0.8; transform: scale(1.02); }

        .status-box { margin-top: 20px; display: none; }
        #messageDisplay {
            background: rgba(255,255,255,0.05); padding: 15px;
            border-radius: 10px; margin-top: 10px; font-style: italic;
            border: 1px dashed var(--primary); display: none;
        }
    </style>
</head>
<body id="bodyTag">

    <div class="stars"></div>

    <audio id="lockSound" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
    <audio id="unlockSound" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

    <div class="toolbar">
        <select id="langSelect" onchange="changeLanguage(this.value)">
            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="en">English</option>
            <option value="fr">FranÃ§ais</option>
            <option value="zh">ä¸­æ–‡</option>
            <option value="es">EspaÃ±ol</option>
        </select>
        <div class="themes">
            <button class="theme-btn" onclick="setTheme('default')">ğŸ”µ</button>
            <button class="theme-btn" onclick="setTheme('purple')">ğŸŸ£</button>
            <button class="theme-btn" onclick="setTheme('green')">ğŸŸ¢</button>
        </div>
    </div>

    <div class="capsule-container">
        <div class="logo-container">
            <svg width="50" height="50" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L4.5 20.29L5.21 21L12 18L18.79 21L19.5 20.29L12 2Z" stroke="var(--primary)" stroke-width="2" fill="var(--accent)"/>
            </svg>
        </div>

        <h1 id="title">ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø²Ù…Ù† ğŸš€</h1>

        <div id="authArea">
            <p id="authDesc">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„ØªØµÙ„Ùƒ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Gmail</p>
            <input type="email" id="userEmail" placeholder="example@gmail.com">
            <button class="main-btn" id="loginBtn" onclick="startExperience()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªÙƒØ´Ù ğŸ‘¨â€ğŸš€</button>
        </div>

        <div id="setupArea" style="display: none;">
            <p id="desc">Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„:</p>
            <textarea id="userNote" class="hidden-note" onfocus="this.classList.remove('hidden-note')" onblur="this.classList.add('hidden-note')"></textarea>
            <input type="datetime-local" id="openDate">
            <button class="main-btn" id="lockBtn" onclick="lockCapsule()">Ù‚ÙÙ„ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© ğŸ”’</button>
        </div>

        <div id="statusArea" class="status-box">
            <h3 id="timerTitle">Ù…ØºÙ„Ù‚Ø©</h3>
            <div id="countdown" style="font-size: 2rem; margin: 15px 0; color: var(--primary); font-weight: bold;"></div>
            <div id="messageDisplay"></div>
            <button class="main-btn" id="resetBtn" onclick="resetAll()" style="display:none; margin-top:20px; background:#ef4444; color:white;">ğŸ”„</button>
        </div>
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        const translations = {
            ar: { title: "ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø²Ù…Ù† ğŸš€", authDesc: "Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„ØªØµÙ„Ùƒ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Gmail", loginBtn: "Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªÙƒØ´Ù ğŸ‘¨â€ğŸš€", desc: "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„:", placeholder: "Ø§ÙƒØªØ¨ Ø£Ø³Ø±Ø§Ø±Ùƒ Ù‡Ù†Ø§...", lockBtn: "Ù‚ÙÙ„ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© ğŸ”’", timerTitle: "Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ù…Ø¯Ø§Ø±...", resetBtn: "Ø¬Ø¯ÙŠØ¯ ğŸ”„", alert: "Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!", emailSub: "ØªÙ… Ù‚ÙÙ„ ÙƒØ¨Ø³ÙˆÙ„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!", emailBody: "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ØªÙ… Ø­ÙØ¸ Ø±Ø³Ø§Ù„ØªÙƒ. Ù…ÙˆØ¹Ø¯ Ø§Ù„ÙØªØ­: ", success: "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯ Ù„Ø¨Ø±ÙŠØ¯Ùƒ!", unlockSub: "ğŸ”“ ÙØªØ­Øª ÙƒØ¨Ø³ÙˆÙ„ØªÙƒ Ø§Ù„Ø¢Ù†!", unlockBody: "Ø±Ø³Ø§Ù„ØªÙƒ Ù…Ù† Ø§Ù„Ù…Ø§Ø¶ÙŠ Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†. Ø§Ø±Ø¬Ø¹ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø·:", revealBtn: "ÙƒØ´Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±", dir: "rtl" },
            en: { title: "Time Capsule ğŸš€", authDesc: "Login for Gmail alerts", loginBtn: "Explorer Login ğŸ‘¨â€ğŸš€", desc: "Write to the future:", placeholder: "Your secrets...", lockBtn: "Lock ğŸ”’", timerTitle: "In orbit...", resetBtn: "New ğŸ”„", alert: "Fill fields!", emailSub: "Capsule Locked!", emailBody: "Hello, message saved. Unlock date: ", success: "Confirmation sent!", unlockSub: "ğŸ”“ Capsule Unlocked!", unlockBody: "Your message is ready. Return via link:", revealBtn: "Reveal & Notify Me", dir: "ltr" }
        };

        let currentLang = localStorage.getItem('lang') || 'ar';
        let currentTheme = localStorage.getItem('theme') || 'default';
        
        emailjs.init("NinIk0LzvyV4NVzoD");

        function setTheme(theme) {
            document.getElementById('bodyTag').className = (theme === 'default' ? '' : 'theme-' + theme);
            localStorage.setItem('theme', theme);
        }

        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            updateUI();
        }

        function updateUI() {
            const t = translations[currentLang] || translations['en'];
            document.getElementById('htmlTag').dir = t.dir;
            document.getElementById('title').innerText = t.title;
            document.getElementById('authDesc').innerText = t.authDesc;
            document.getElementById('loginBtn').innerText = t.loginBtn;
            document.getElementById('desc').innerText = t.desc;
            document.getElementById('userNote').placeholder = t.placeholder;
            document.getElementById('lockBtn').innerText = t.lockBtn;
            document.getElementById('timerTitle').innerText = t.timerTitle;
            document.getElementById('resetBtn').innerText = t.resetBtn;
        }

        function startExperience() {
            const email = document.getElementById('userEmail').value;
            if (email.includes('@')) {
                localStorage.setItem('userEmail', email);
                checkStatus();
            } else { alert(translations[currentLang].alert); }
        }

        function lockCapsule() {
            const date = document.getElementById('openDate').value;
            const note = document.getElementById('userNote').value;
            const email = localStorage.getItem('userEmail');
            const t = translations[currentLang] || translations['en'];

            if (!date || !note) { alert(t.alert); return; }

            document.getElementById('lockSound').play();
            localStorage.setItem('unlockTime', new Date(date).getTime());
            localStorage.setItem('secretNote', note);

            emailjs.send("service_fs1s2c5", "template_fdh2uj3", {
                email: email,
                subject_line: t.emailSub,
                message: "Locked Securely",
                open_date: date,
                intro_text: t.emailBody,
                site_link: window.location.href
            }).then(() => {
                alert(t.success);
                checkStatus();
            });
        }

        function checkStatus() {
            const unlockTime = localStorage.getItem('unlockTime');
            const email = localStorage.getItem('userEmail');
            const t = translations[currentLang] || translations['en'];

            if (email) { document.getElementById('authArea').style.display = 'none'; document.getElementById('setupArea').style.display = 'block'; }

            if (unlockTime) {
                document.getElementById('setupArea').style.display = 'none';
                document.getElementById('statusArea').style.display = 'block';
                
                const timerInterval = setInterval(() => {
                    const distance = unlockTime - new Date().getTime();
                    if (distance > 0) {
                        const d = Math.floor(distance / 86400000);
                        const h = Math.floor((distance % 86400000) / 3600000);
                        const m = Math.floor((distance % 3600000) / 60000);
                        const s = Math.floor((distance % 60000) / 1000);
                        document.getElementById('countdown').innerHTML = `${d}d ${h}:${m}:${s}`;
                    } else {
                        clearInterval(timerInterval);
                        document.getElementById('timerTitle').innerHTML = "âœ¨ Ready! âœ¨";
                        document.getElementById('countdown').innerHTML = `<button class="main-btn" onclick="revealCapsule()">${t.revealBtn}</button>`;
                    }
                }, 1000);
            }
        }

        function revealCapsule() {
            const email = localStorage.getItem('userEmail');
            const note = localStorage.getItem('secretNote');
            const t = translations[currentLang] || translations['en'];

            document.getElementById('unlockSound').play();
            document.getElementById('messageDisplay').style.display = 'block';
            document.getElementById('messageDisplay').innerHTML = `"${note}"`;
            document.getElementById('resetBtn').style.display = 'block';
            document.getElementById('countdown').style.display = 'none';

            emailjs.send("service_fs1s2c5", "template_fdh2uj3", {
                email: email,
                subject_line: t.unlockSub,
                message: "Your capsule is open! Content: " + note,
                intro_text: t.unlockBody,
                site_link: window.location.href
            }).then(() => console.log("Unlock Email Sent")).catch(err => console.log(err));
        }

        function resetAll() { localStorage.clear(); location.reload(); }

        updateUI();
        checkStatus();
    </script>
</body>
</html>
